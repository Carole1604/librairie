<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Liste des Prolongements</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2>Liste des Demandes de Prolongement</h2>
    <a th:href="@{/prolongements/demande}" class="btn btn-primary mb-3">Nouvelle demande</a>
    
    <div th:if="${#lists.isEmpty(prolongements)}" class="alert alert-info">
        Aucune demande de prolongement trouvée.
    </div>
    
    <table th:if="${!#lists.isEmpty(prolongements)}" class="table table-bordered">
        <thead>
        <tr>
            <th>ID</th>
            <th>Adhérent</th>
            <th>Livre</th>
            <th>Date de demande</th>
            <th>Nouvelle date de rendu</th>
            <th>Statut</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="prolongement : ${prolongements}">
            <td th:text="${prolongement.id}"></td>
            <td th:text="${prolongement.pret != null and prolongement.pret.adherent != null ? prolongement.pret.adherent.nom + ' ' + prolongement.pret.adherent.prenom : 'N/A'}"></td>
            <td th:text="${prolongement.pret != null and prolongement.pret.exemplaire != null and prolongement.pret.exemplaire.livre != null ? prolongement.pret.exemplaire.livre.titre : 'N/A'}"></td>
            <td th:text="${prolongement.dateDemande != null ? #temporals.format(prolongement.dateDemande, 'dd/MM/yyyy') : 'N/A'}"></td>
            <td th:text="${prolongement.nouvelleDateRendu != null ? #temporals.format(prolongement.nouvelleDateRendu, 'dd/MM/yyyy') : 'N/A'}"></td>
            <td>
                <span th:if="${prolongement.statut != null and prolongement.statut.nomStatut == 'en_cours'}" class="badge bg-warning">En attente</span>
                <span th:if="${prolongement.statut != null and prolongement.statut.nomStatut == 'valide'}" class="badge bg-success">Validé</span>
                <span th:if="${prolongement.statut != null and prolongement.statut.nomStatut == 'refuse'}" class="badge bg-danger">Refusé</span>
                <span th:if="${prolongement.statut == null}" class="badge bg-secondary">Non défini</span>
            </td>
            <td>
                <div th:if="${prolongement.statut != null and prolongement.statut.nomStatut == 'en_cours'}">
                    <a th:href="@{'/prolongements/validation/' + ${prolongement.id}}" class="btn btn-success btn-sm">Valider/Refuser</a>
                </div>
                <div th:if="${prolongement.statut == null or prolongement.statut.nomStatut != 'en_cours'}">
                    <span class="text-muted">Traité</span>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <a th:href="@{/prets/liste}" class="btn btn-secondary">Retour aux prêts</a>
</div>
</body>
</html> 